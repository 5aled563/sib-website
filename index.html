<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIB - Services Id√©ales de Bureaux</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { font-family: Arial, sans-serif; background-color: #f8f9fa; }
.text-danger { color: #FF0000 !important; }
.btn-danger { background-color: #FF0000; border-color: #FF0000; }
.btn-danger:hover { background-color: #cc0000; border-color: #cc0000; }
.logo { max-height: 50px; }
.tab-content { padding-top: 20px; }
footer a { text-decoration: none; color: white; }
.card img { height: 200px; object-fit: cover; }
</style>
</head>
<body>

<header class="bg-danger text-white py-3">
<div class="container d-flex justify-content-between align-items-center">
<img src="logo.png" alt="Logo SIB" class="logo" id="site-logo">
<h3>SIB - Services Id√©ales de Bureaux</h3>
</div>
</header>

<div class="container my-5">
<ul class="nav nav-tabs" id="myTab" role="tablist">
<li class="nav-item"><button class="nav-link active text-danger" data-bs-toggle="tab" data-bs-target="#accueil">Accueil</button></li>
<li class="nav-item"><button class="nav-link text-danger" data-bs-toggle="tab" data-bs-target="#produits">Produits</button></li>
<li class="nav-item"><button class="nav-link text-danger" data-bs-toggle="tab" data-bs-target="#contact">Contact</button></li>
<li class="nav-item"><button class="nav-link text-danger" data-bs-toggle="tab" data-bs-target="#panier">Panier</button></li>
<li class="nav-item"><button class="nav-link text-danger" data-bs-toggle="tab" data-bs-target="#compte">Mon Compte</button></li>
<li class="nav-item"><button class="nav-link text-danger" data-bs-toggle="tab" data-bs-target="#admin">Admin</button></li>
</ul>

<div class="tab-content" id="myTabContent">

<!-- Accueil -->
<div class="tab-pane fade show active" id="accueil">
<h1 class="text-danger">Bienvenue chez SIB</h1>
<p>Votre partenaire en solutions informatiques et bureautiques.</p>
<h3 class="text-danger">Annonces</h3>
<div id="posts-list"></div>
</div>

<!-- Produits -->
<div class="tab-pane fade" id="produits">
<h2 class="text-danger">Nos Produits</h2>
<div id="produits-list" class="row"></div>
</div>

<!-- Contact -->
<div class="tab-pane fade" id="contact">
<h2 class="text-danger">Contactez-nous</h2>
<form id="contact-form">
<div class="mb-3"><label>Nom</label><input type="text" class="form-control" id="nom" required></div>
<div class="mb-3"><label>Email</label><input type="email" class="form-control" id="email" required></div>
<div class="mb-3"><label>Message</label><textarea class="form-control" id="message" rows="3" required></textarea></div>
<button type="submit" class="btn btn-danger">Envoyer</button>
</form>
</div>

<!-- Panier -->
<div class="tab-pane fade" id="panier">
<h2 class="text-danger">Votre Panier</h2>
<div id="panier-list"></div>
<button id="commander-btn" class="btn btn-danger mt-3">Commander</button>
</div>

<!-- Compte -->
<div class="tab-pane fade" id="compte">
<h2 class="text-danger">Mon Compte</h2>

<!-- Connexion -->
<form id="login-form">
<h5>Connexion</h5>
<div class="mb-3"><label>Email</label><input type="email" class="form-control" id="login-email" required></div>
<div class="mb-3"><label>Mot de passe</label><input type="password" class="form-control" id="login-password" required></div>
<button type="submit" class="btn btn-danger">Se connecter</button>
</form>

<hr>

<!-- Cr√©ation de compte -->
<form id="register-form">
<h5>Cr√©er un compte</h5>
<div class="mb-3"><label>Email</label><input type="email" class="form-control" id="register-email" required></div>
<div class="mb-3"><label>Mot de passe</label><input type="password" class="form-control" id="register-password" required></div>
<div class="mb-3">
<label>Type de compte</label>
<select class="form-control" id="register-type">
<option value="particulier">Particulier</option>
<option value="entreprise">Entreprise</option>
</select>
</div>
<div class="mb-3" id="register-matricule-field" style="display:none;">
<label>Matricule Fiscale</label>
<input type="text" class="form-control" id="register-matricule">
</div>
<button type="submit" class="btn btn-danger">Cr√©er un compte</button>
</form>
</div>

<!-- Admin -->
<div class="tab-pane fade" id="admin">
<h2 class="text-danger">Administration</h2>
<form id="admin-login-form">
<div class="mb-3"><label>Email</label><input type="email" class="form-control" id="admin-email" required></div>
<div class="mb-3"><label>Mot de passe</label><input type="password" class="form-control" id="admin-password" required></div>
<button type="submit" class="btn btn-danger">Se connecter</button>
</form>

<div id="admin-panel" style="display:none;">
<h3>Gestion des produits</h3>
<form id="add-product-form">
<div class="mb-3"><label>Nom</label><input type="text" class="form-control" id="product-name" required></div>
<div class="mb-3"><label>Prix</label><input type="number" class="form-control" id="product-price" required></div>
<div class="mb-3"><label>Stock</label><input type="number" class="form-control" id="product-stock" required></div>
<div class="mb-3"><label>Photo</label><input type="file" class="form-control" id="product-photo" accept="image/*"></div>
<button type="submit" class="btn btn-danger">Ajouter Produit</button>
</form>
<div id="admin-products-list"></div>

<h3>Gestion des annonces</h3>
<form id="add-post-form">
<div class="mb-3"><label>Titre</label><input type="text" class="form-control" id="post-title" required></div>
<div class="mb-3"><label>Contenu</label><textarea class="form-control" id="post-content" rows="2" required></textarea></div>
<button type="submit" class="btn btn-danger">Ajouter Annonce</button>
</form>
<div id="admin-posts-list"></div>
</div>
</div>

</div>

<footer class="bg-dark text-white text-center p-3">
<p>&copy; 2025 SIB - Tous droits r√©serv√©s</p>
<p>üìû +216 90 202 000 | ‚úâÔ∏è <a href="mailto:sibjerba@yahoo.fr">sibjerba@yahoo.fr</a></p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
const BIN_ID='69038ad6d0ea881f40c77262';
const API_KEY='$2a$10$SM/b.U8uHOuR8HQq49OfQeVGonwnFopJUN5O5UUoaQJheFE0dedxW';
const BASE_URL=`https://api.jsonbin.io/v3/b/${BIN_ID}`;

async function sauvegarderDonnees(data){
    await fetch(BASE_URL,{method:'PUT',headers:{'Content-Type':'application/json','X-Master-Key':API_KEY},body:JSON.stringify(data)});
}
async function chargerDonnees(){
    const res=await fetch(BASE_URL,{headers:{'X-Master-Key':API_KEY}});
    const json=await res.json();
    return json.record;
}

let produits=[], clients=[], commandes=[], panier=[], posts=[], currentClient=null;

(async ()=>{
    const data=await chargerDonnees();
    produits=data.produits||[];
    clients=data.clients||[];
    commandes=data.commandes||[];
    panier=data.panier||[];
    posts=data.posts||[];
    displayProducts();
    displayPanier();
    displayPosts();
    displayAdminProducts();
    displayAdminPosts();
})();

// PRODUITS
function displayProducts(){
    const list=document.getElementById('produits-list'); list.innerHTML='';
    produits.forEach(p=>list.innerHTML+=`<div class="col-md-4"><div class="card mb-3"><img src="${p.photo||'placeholder.jpg'}" class="card-img-top"><div class="card-body"><h5>${p.name}</h5><p>Prix: ${p.price} DT</p><button class="btn btn-danger" onclick="addToPanier(${p.id})">Ajouter au Panier</button></div></div></div>`);
}
function addToPanier(id){
    if(!currentClient){ alert("Connectez-vous pour ajouter au panier."); return; }
    const product=produits.find(p=>p.id===id);
    panier.push({...product, client:currentClient.email});
    sauvegarderDonnees({produits, clients, commandes, panier, posts});
    displayPanier();
}
function displayPanier(){
    const list=document.getElementById('panier-list'); list.innerHTML='';
    const clientPanier=panier.filter(p=>!currentClient||p.client===currentClient.email);
    clientPanier.forEach(p=>list.innerHTML+=`<p>${p.name} - ${p.price} DT</p>`);
}
document.getElementById('commander-btn').addEventListener('click', async ()=>{
    if(!currentClient){ alert("Connectez-vous pour commander."); return; }
    const clientPanier=panier.filter(p=>p.client===currentClient.email);
    if(clientPanier.length>0){
        commandes.push({items:clientPanier,status:'En cours',client:currentClient.email});
        panier=panier.filter(p=>p.client!==currentClient.email);
        await sauvegarderDonnees({produits, clients, commandes, panier, posts});
        displayPanier();
        alert("Commande enregistr√©e !");
    }
});

// COMPTE
document.getElementById('register-type').addEventListener('change',()=>{document.getElementById('register-matricule-field').style.display=document.getElementById('register-type').value==='entreprise'?'block':'none';});
document.getElementById('register-form').addEventListener('submit', async e=>{
    e.preventDefault();
    const email=document.getElementById('register-email').value;
    const password=document.getElementById('register-password').value;
    const type=document.getElementById('register-type').value;
    const matricule=document.getElementById('register-matricule').value;
    if(clients.find(c=>c.email===email)){ alert("Email d√©j√† utilis√© !"); return; }
    const client={email,password,type,matricule};
    clients.push(client);
    currentClient=client;
    await sauvegarderDonnees({produits, clients, commandes, panier, posts});
    alert("Compte cr√©√© et connect√© !");
});
document.getElementById('login-form').addEventListener('submit', e=>{
    e.preventDefault();
    const email=document.getElementById('login-email').value;
    const password=document.getElementById('login-password').value;
    const client=clients.find(c=>c.email===email&&c.password===password);
    if(client){ currentClient=client; alert("Connect√© !"); displayPanier(); }
    else alert("Email ou mot de passe incorrect !");
});

// ADMIN
document.getElementById('admin-login-form').addEventListener('submit', e=>{
    e.preventDefault();
    const email=document.getElementById('admin-email').value;
    const pass=document.getElementById('admin-password').value;
    if(email==='admin@sib.tn'&&pass==='sadok2025'){
        document.getElementById('admin-panel').style.display='block';
        e.target.style.display='none';
    }else alert("Acc√®s refus√© !");
});
document.getElementById('add-product-form').addEventListener('submit', async e=>{
    e.preventDefault();
    const name=document.getElementById('product-name').value;
    const price=document.getElementById('product-price').value;
    const stock=document.getElementById('product-stock').value;
    const photo=document.getElementById('product-photo').files[0]?URL.createObjectURL(document.getElementById('product-photo').files[0]):'';
    produits.push({id:Date.now(),name,price,stock,photo});
    await sauvegarderDonnees({produits, clients, commandes, panier, posts});
    displayProducts(); displayAdminProducts();
});
function displayAdminProducts(){
    const list=document.getElementById('admin-products-list'); list.innerHTML='';
    produits.forEach(p=>list.innerHTML+=`<p>${p.name} - ${p.price} DT <button class="btn btn-sm btn-danger" onclick="editProduct(${p.id})">Modifier</button> <button class="btn btn-sm btn-danger" onclick="deleteProduct(${p.id})">Supprimer</button></p>`);
}
function deleteProduct(id){
    produits=produits.filter(p=>p.id!==id);
    sauvegarderDonnees({produits, clients, commandes, panier, posts});
    displayProducts(); displayAdminProducts();
}
function editProduct(id){
    const p=produits.find(p=>p.id===id);
    const newName=prompt("Nom:",p.name);
    const newPrice=prompt("Prix:",p.price);
    const newStock=prompt("Stock:",p.stock);
    if(newName&&newPrice&&newStock){ p.name=newName; p.price=newPrice; p.stock=newStock; sauvegarderDonnees({produits, clients, commandes, panier, posts}); displayProducts(); displayAdminProducts(); }
}

// POSTS
function displayPosts(){ const list=document.getElementById('posts-list'); list.innerHTML=''; posts.forEach(p=>list.innerHTML+=`<div class="card mb-2 p-2"><h5>${p.title}</h5><p>${p.content}</p></div>`);}
document.getElementById('add-post-form').addEventListener('submit', async e=>{
    e.preventDefault();
    const title=document.getElementById('post-title').value;
    const content=document.getElementById('post-content').value;
    posts.push({id:Date.now(),title,content});
    await sauvegarderDonnees({produits, clients, commandes, panier, posts});
    displayPosts(); displayAdminPosts();
});
function displayAdminPosts(){ const list=document.getElementById('admin-posts-list'); list.innerHTML=''; posts.forEach(p=>list.innerHTML+=`<p>${p.title} - <button class="btn btn-sm btn-danger" onclick="deletePost(${p.id})">Supprimer</button></p>`);}
function deletePost(id){ posts=posts.filter(p=>p.id!==id); sauvegarderDonnees({produits, clients, commandes, panier, posts}); displayPosts(); displayAdminPosts();}
</script>
</body>
</html>
