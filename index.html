<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SIB ‚Äî Catalogue Informatique & Bureautique</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f8f9fa; }
    .product-card img { height: 180px; object-fit: contain; }
    .btn-danger { background-color: #ff002b; border-color: #ff002b; }
    .btn-danger:hover { background-color: #cc0023; }
    .logo { max-height: 50px; }
    footer a { color: white; text-decoration: none; }
  </style>
</head>
<body>

<header class="bg-danger text-white py-3">
  <div class="container d-flex justify-content-between align-items-center">
    <img src="logo.png" class="logo" alt="Logo SIB" id="site-logo">
    <h3>SIB ‚Äî Informatique & Bureautique</h3>
  </div>
</header>

<nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
  <div class="container">
    <a class="navbar-brand" href="#" onclick="showSection('catalog')">Catalogue</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('catalog')">Produits</a></li>
        <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('panier')">Panier</a></li>
        <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('account')">Compte</a></li>
        <li class="nav-item"><a class="nav-link" href="#" onclick="showSection('admin')">Admin</a></li>
      </ul>
    </div>
  </div>
</nav>

<main class="container my-4">

  <!-- Catalogue / cat√©gorie -->
  <section id="catalog" class="section" style="display:block;">
    <div class="row mb-3">
      <div class="col-md-4">
        <input type="text" id="filter-keyword" class="form-control" placeholder="Rechercher‚Ä¶"/>
      </div>
      <div class="col-md-4">
        <select id="filter-category" class="form-select">
          <option value="">Toutes cat√©gories</option>
          <!-- cat√©gories ajout√©es dynamiquement -->
        </select>
      </div>
      <div class="col-md-4 text-end">
        <button class="btn btn-danger" onclick="applyFilters()">Filtrer</button>
      </div>
    </div>
    <div class="row" id="product-grid"></div>
  </section>

  <!-- Panier -->
  <section id="panier" class="section" style="display:none;">
    <h2>Votre Panier</h2>
    <div id="cart-items"></div>
    <button id="btn-checkout" class="btn btn-danger mt-3">Valider la commande</button>
  </section>

  <!-- Compte client -->
  <section id="account" class="section" style="display:none;">
    <h2>Mon Compte</h2>
    <div id="account-forms">
      <form id="login-form">
        <div class="mb-3"><label>Email</label><input type="email" class="form-control" id="login-email" required></div>
        <div class="mb-3"><label>Mot de passe</label><input type="password" class="form-control" id="login-password" required></div>
        <button class="btn btn-danger" type="submit">Se connecter</button>
      </form>
      <hr/>
      <form id="register-form">
        <div class="mb-3"><label>Email</label><input type="email" class="form-control" id="register-email" required></div>
        <div class="mb-3"><label>Mot de passe</label><input type="password" class="form-control" id="register-password" required></div>
        <button class="btn btn-danger" type="submit">Cr√©er un compte</button>
      </form>
    </div>
  </section>

  <!-- Admin -->
  <section id="admin" class="section" style="display:none;">
    <h2>Administration</h2>
    <form id="admin-login-form">
      <div class="mb-3"><label>Email</label><input type="email" class="form-control" id="admin-email" required></div>
      <div class="mb-3"><label>Mot de passe</label><input type="password" class="form-control" id="admin-password" required></div>
      <button class="btn btn-danger" type="submit">Se connecter</button>
    </form>
    <div id="admin-panel" style="display:none;">
      <h3>Produits</h3>
      <form id="admin-add-form" class="mb-3">
        <div class="mb-2"><input type="text" id="admin-prod-name" class="form-control" placeholder="Nom produit"></div>
        <div class="mb-2"><input type="number" id="admin-prod-price" class="form-control" placeholder="Prix"></div>
        <div class="mb-2"><input type="text" id="admin-prod-cat" class="form-control" placeholder="Cat√©gorie"></div>
        <div class="mb-2"><input type="text" id="admin-prod-photo" class="form-control" placeholder="URL photo"></div>
        <button class="btn btn-danger" type="submit">Ajouter produit</button>
      </form>
      <div id="admin-product-list"></div>

      <h3 class="mt-4">Annonces</h3>
      <form id="admin-post-form" class="mb-3">
        <div class="mb-2"><input type="text" id="admin-post-title" class="form-control" placeholder="Titre"></div>
        <div class="mb-2"><textarea id="admin-post-content" class="form-control" placeholder="Contenu"></textarea></div>
        <button class="btn btn-danger" type="submit">Ajouter annonce</button>
      </form>
      <div id="admin-post-list"></div>
    </div>
  </section>

</main>

<footer class="bg-dark text-white text-center p-3">
  <p>&copy; 2025 SIB ‚Äî Tous droits r√©serv√©s</p>
  <p>üìû +216 90 202 000 | ‚úâÔ∏è <a href="mailto:sibjerba@yahoo.fr">sibjerba@yahoo.fr</a></p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Configuration JSONBin
const BIN_ID = '69038ad6d0ea881f40c77262';
const API_KEY = '$2a$10$SM/b.U8uHOuR8HQq49OfQeVGonwnFopJUN5O5UUoaQJheFE0dedxW';
const BASE_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

// Fonction pour charger donn√©es
async function chargerDonnees() {
  const resp = await fetch(BASE_URL, {
    headers: { 'X-Master-Key': API_KEY }
  });
  const j = await resp.json();
  return j.record;
}

// Fonction pour sauvegarder
async function sauvegarderDonnees(data) {
  await fetch(BASE_URL, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'X-Master-Key': API_KEY
    },
    body: JSON.stringify(data)
  });
}

// Donn√©es en m√©moire
let produits = [];
let clients = [];
let commandes = [];
let posts = [];
let panier = [];
let currentClient = null;

// Initialisation
(async () => {
  const d = await chargerDonnees();
  produits = d.produits || [];
  clients = d.clients || [];
  commandes = d.commandes || [];
  posts = d.posts || [];
  panier = d.panier || [];
  renderProducts();
  renderPosts();
})();

// Montrer / cacher section
function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
  const sec = document.getElementById(id);
  if (sec) sec.style.display = 'block';
}

// Rendu des produits
function renderProducts(filter = {}) {
  const grid = document.getElementById('produits-list');
  grid.innerHTML = '';
  let arr = produits;
  if (filter.keyword) {
    arr = arr.filter(p => p.name.toLowerCase().includes(filter.keyword.toLowerCase()));
  }
  if (filter.category) {
    arr = arr.filter(p => p.category === filter.category);
  }
  arr.forEach(p => {
    const html = `
      <div class="col-md-4 mb-3">
        <div class="card product-card">
          <img src="${p.photo || 'placeholder.jpg'}" class="card-img-top">
          <div class="card-body">
            <h5>${p.name}</h5>
            <p>${p.price} DT</p>
            <button class="btn btn-danger" onclick="addToCart(${p.id})">Ajouter au panier</button>
          </div>
        </div>
      </div>`;
    grid.insertAdjacentHTML('beforeend', html);
  });
}

// Filtrer
function applyFilters() {
  const kw = document.getElementById('filter-keyword').value;
  const cat = document.getElementById('filter-category').value;
  renderProducts({ keyword: kw, category: cat });
}

// Panier
function addToCart(id) {
  if (!currentClient) { alert("Veuillez vous connecter."); return; }
  const prod = produits.find(p => p.id === id);
  if (prod) {
    panier.push({ ...prod, clientEmail: currentClient.email });
    sauvegarderDonnees({ produits, clients, commandes, posts, panier });
    renderCart();
  }
}
function renderCart() {
  const div = document.getElementById('cart-items');
  div.innerHTML = '';
  const clientCart = panier.filter(it => it.clientEmail === (currentClient?.email || ''));
  clientCart.forEach(it => {
    div.insertAdjacentHTML('beforeend', `<p>${it.name} ‚Äî ${it.price} DT</p>`);
  });
}

// Commander
document.getElementById('btn-checkout').addEventListener('click', async () => {
  if (!currentClient) { alert("Connectez-vous pour commander."); return; }
  const clientCart = panier.filter(it => it.clientEmail === currentClient.email);
  if (clientCart.length === 0) { alert("Panier vide."); return; }
  commandes.push({ id: Date.now(), items: clientCart, client: currentClient.email, status: "En cours" });
  panier = panier.filter(it => it.clientEmail !== currentClient.email);
  await sauvegarderDonnees({ produits, clients, commandes, posts, panier });
  renderCart();
  alert("Commande pass√©e !");
});

// Posts / Annonces
function renderPosts() {
  const div = document.getElementById('posts-list');
  div.innerHTML = '';
  posts.forEach(p => {
    div.insertAdjacentHTML('beforeend', `<div class="card mb-2"><div class="card-body"><h5>${p.title}</h5><p>${p.content}</p></div></div>`);
  });
}

// Connexion / Inscription client
document.getElementById('register-form').addEventListener('submit', async e => {
  e.preventDefault();
  const email = document.getElementById('register-email').value;
  const password = document.getElementById('register-password').value;
  if (clients.some(c => c.email === email)) {
    alert("Email d√©j√† utilis√©.");
    return;
  }
  const newClient = { email, password };
  clients.push(newClient);
  currentClient = newClient;
  await sauvegarderDonnees({ produits, clients, commandes, posts, panier });
  alert("Compte cr√©√© & connect√©");
});

document.getElementById('login-form').addEventListener('submit', e => {
  e.preventDefault();
  const email = document.getElementById('login-email').value;
  const password = document.getElementById('login-password').value;
  const cl = clients.find(c => c.email === email && c.password === password);
  if (cl) {
    currentClient = cl;
    alert("Connect√© !");
    renderCart();
  } else {
    alert("Email / mot de passe incorrect");
  }
});

// Admin
document.getElementById('admin-login-form').addEventListener('submit', e => {
  e.preventDefault();
  const email = document.getElementById('admin-email').value;
  const pass = document.getElementById('admin-password').value;
  if (email === 'admin@sib.tn' && pass === 'sadok2025') {
    document.getElementById('admin-panel').style.display = 'block';
    e.target.style.display = 'none';
  } else alert("Acc√®s refus√©");
});

// Ajouter produit
document.getElementById('admin-add-form').addEventListener('submit', async e => {
  e.preventDefault();
  const name = document.getElementById('admin-prod-name').value;
  const price = Number(document.getElementById('admin-prod-price').value);
  const category = document.getElementById('admin-prod-cat').value;
  const photo = document.getElementById('admin-prod-photo').value;
  produits.push({ id: Date.now(), name, price, category, photo });
  await sauvegarderDonnees({ produits, clients, commandes, posts, panier });
  renderProducts();
  displayAdminProducts();
});

function displayAdminProducts() {
  const div = document.getElementById('admin-product-list');
  div.innerHTML = '';
  produits.forEach(p => {
    div.insertAdjacentHTML('beforeend', `<p>${p.name} ‚Äî ${p.price} DT [${p.category}]
      <button class="btn btn-sm btn-danger" onclick="adminEdit(${p.id})">Modifier</button>
      <button class="btn btn-sm btn-danger" onclick="adminDelete(${p.id})">Supprimer</button>
    </p>`);
  });
}
function adminDelete(id) {
  produits = produits.filter(p => p.id !== id);
  sauvegarderDonnees({ produits, clients, commandes, posts, panier });
  renderProducts();
  displayAdminProducts();
}
function adminEdit(id) {
  const p = produits.find(p => p.id === id);
  const newName = prompt("Nom:", p.name);
  const newPrice = prompt("Prix:", p.price);
  const newCat = prompt("Cat√©gorie:", p.category);
  if (newName && newPrice && newCat) {
    p.name = newName;
    p.price = Number(newPrice);
    p.category = newCat;
    sauvegarderDonnees({ produits, clients, commandes, posts, panier });
    renderProducts();
    displayAdminProducts();
  }
}

// Ajouter annonce
document.getElementById('admin-post-form').addEventListener('submit', async e => {
  e.preventDefault();
  const title = document.getElementById('admin-post-title').value;
  const content = document.getElementById('admin-post-content').value;
  posts.push({ id: Date.now(), title, content });
  await sauvegarderDonnees({ produits, clients, commandes, posts, panier });
  renderPosts();
  displayAdminPosts();
});
function displayAdminPosts() {
  const div = document.getElementById('admin-post-list');
  div.innerHTML = '';
  posts.forEach(p => {
    div.insertAdjacentHTML('beforeend', `<p>${p.title}
      <button class="btn btn-sm btn-danger" onclick="adminDeletePost(${p.id})">Supprimer</button>
    </p>`);
  });
}
function adminDeletePost(id) {
  posts = posts.filter(p => p.id !== id);
  sauvegarderDonnees({ produits, clients, commandes, posts, panier });
  renderPosts();
  displayAdminPosts();
}
</script>
</body>
</html>
