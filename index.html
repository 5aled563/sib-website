<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIB - Services Id√©ales de Bureaux</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: Arial, sans-serif; background-color: #f8f9fa; }
        .logo { max-height: 60px; }
        .btn-danger { background-color: #FF0000; border-color: #FF0000; }
        .btn-danger:hover { background-color: #cc0000; border-color: #cc0000; }
        .card { margin-bottom: 20px; }
        .admin-panel { display: none; background-color: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        footer { background-color: #FF0000; color: #fff; padding: 20px; text-align: center; margin-top: 50px; }
        .alert-announcement { background-color: #fff3cd; padding: 10px; margin-bottom: 20px; border-radius: 5px; color: #856404; }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="bg-danger text-white py-3 mb-4">
        <div class="container d-flex justify-content-between align-items-center">
            <img src="logo.png" alt="Logo SIB" class="logo" id="site-logo">
            <h3>SIB - Services Id√©ales de Bureaux</h3>
            <button class="btn btn-light" onclick="toggleAdminLogin()">Admin</button>
        </div>
    </header>

    <div class="container">
        <!-- Annonces -->
        <div id="announcements"></div>

        <!-- Produits -->
        <h2 class="mb-3">Nos Produits</h2>
        <div class="row" id="products-list"></div>

        <!-- Panier -->
        <h2 class="mt-5">Panier</h2>
        <div id="cart-list" class="mb-3"></div>
        <button class="btn btn-danger mb-5" onclick="checkout()">Commander</button>

        <!-- Compte Client -->
        <h2>Mon Compte</h2>
        <form id="client-form" class="mb-5">
            <div class="mb-3">
                <label>Email</label>
                <input type="email" id="client-email" class="form-control" required>
            </div>
            <div class="mb-3">
                <label>Mot de passe</label>
                <input type="password" id="client-password" class="form-control" required>
            </div>
            <div class="mb-3">
                <label>Type de compte</label>
                <select id="client-type" class="form-control">
                    <option value="particulier">Particulier</option>
                    <option value="entreprise">Entreprise</option>
                </select>
            </div>
            <div class="mb-3" id="client-matricule-field" style="display:none;">
                <label>Matricule fiscale</label>
                <input type="text" id="client-matricule" class="form-control">
            </div>
            <button type="submit" class="btn btn-danger">Se connecter / S'inscrire</button>
        </form>

        <!-- Admin Login -->
        <div id="admin-login" style="display:none;" class="mb-4">
            <h3>Connexion Admin</h3>
            <form id="admin-login-form">
                <div class="mb-3">
                    <label>Email</label>
                    <input type="email" id="admin-email" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>Mot de passe</label>
                    <input type="password" id="admin-password" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-danger">Se connecter</button>
            </form>
        </div>

        <!-- Admin Panel -->
        <div id="admin-panel" class="admin-panel">
            <h3>Dashboard Admin</h3>
            <button class="btn btn-secondary mb-3" onclick="logoutAdmin()">D√©connexion Admin</button>
            <hr>
            <h4>Gestion Produits</h4>
            <form id="add-product-form" class="mb-3">
                <input type="text" id="product-name" class="form-control mb-2" placeholder="Nom produit" required>
                <input type="number" id="product-price" class="form-control mb-2" placeholder="Prix" required>
                <input type="number" id="product-stock" class="form-control mb-2" placeholder="Stock" required>
                <input type="text" id="product-photo" class="form-control mb-2" placeholder="URL Photo">
                <button type="submit" class="btn btn-danger">Ajouter Produit</button>
            </form>
            <hr>
            <h4>Gestion Clients</h4>
            <div id="clients-list"></div>
            <hr>
            <h4>Gestion Commandes</h4>
            <div id="orders-list"></div>
            <hr>
            <h4>Site</h4>
            <input type="text" id="new-logo" class="form-control mb-2" placeholder="Nouvelle URL Logo">
            <input type="text" id="new-contact" class="form-control mb-2" placeholder="Nouvelle info contact">
            <textarea id="new-announcement" class="form-control mb-2" placeholder="Nouvelle annonce"></textarea>
            <button class="btn btn-danger" onclick="updateSiteInfo()">Appliquer Modifications</button>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 SIB - Tous droits r√©serv√©s</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // üîπ JSON Bin configuration
        const BIN_ID = "69038ad6d0ea881f40c77262";
        const API_KEY = "$2a$10$Dq1X9Ob0mgW3UmcpcK39NO.lZuEb2i0ZLl4E0xWfSTlNeNOkXNk0e"; // Secret, seulement admin peut le voir
        const BASE_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}/latest`;

        // üîπ Donn√©es globales
        let products = [];
        let clients = [];
        let orders = [];
        let announcements = [];
        let siteInfo = { logo: 'logo.png', contact: 'contact@sib.tn', announcements: [] };
        let adminLoggedIn = false;
        let cart = [];

        // üîπ Fonctions pour JSON Bin
        async function chargerDonnees() {
            try {
                const res = await fetch(BASE_URL, { headers: { "X-Master-Key": API_KEY } });
                const json = await res.json();
                const data = json.record;
                products = data.products || [];
                clients = data.clients || [];
                orders = data.orders || [];
                siteInfo = data.siteInfo || siteInfo;
                announcements = siteInfo.announcements || [];
                updateSiteUI();
                displayProducts();
                displayCart();
                displayClients();
                displayOrders();
            } catch (err) {
                console.log("Erreur chargement donn√©es:", err);
            }
        }

        async function sauvegarderDonnees() {
            try {
                await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                        "X-Master-Key": API_KEY
                    },
                    body: JSON.stringify({ products, clients, orders, siteInfo })
                });
            } catch (err) {
                console.log("Erreur sauvegarde:", err);
            }
        }

        // üîπ Affichage produits
        function displayProducts() {
            const list = document.getElementById('products-list');
            list.innerHTML = '';
            products.forEach(p => {
                list.innerHTML += `
                    <div class="col-md-4">
                        <div class="card">
                            <img src="${p.photo || 'placeholder.jpg'}" class="card-img-top">
                            <div class="card-body">
                                <h5>${p.name}</h5>
                                <p>Prix: ${p.price} DT</p>
                                <button class="btn btn-danger" onclick="addToCart(${p.id})">Ajouter au Panier</button>
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // üîπ Ajouter au panier
        function addToCart(id) {
            const product = products.find(p => p.id === id);
            cart.push(product);
            displayCart();
        }

        function displayCart() {
            const list = document.getElementById('cart-list');
            list.innerHTML = '';
            cart.forEach(p => list.innerHTML += `<p>${p.name} - ${p.price} DT</p>`);
        }

        function checkout() {
            if(cart.length === 0) return alert("Panier vide !");
            orders.push({ id: Date.now(), items: cart, status: "En cours" });
            cart = [];
            displayCart();
            sauvegarderDonnees();
            alert("Commande enregistr√©e !");
        }

        // üîπ Gestion compte client
        document.getElementById('client-type').addEventListener('change', e => {
            document.getElementById('client-matricule-field').style.display = e.target.value === 'entreprise' ? 'block' : 'none';
        });

        document.getElementById('client-form').addEventListener('submit', e => {
            e.preventDefault();
            const email = document.getElementById('client-email').value;
            const password = document.getElementById('client-password').value;
            const type = document.getElementById('client-type').value;
            const matricule = document.getElementById('client-matricule').value;
            clients.push({ email, password, type, matricule });
            sauvegarderDonnees();
            alert("Compte cr√©√© / connect√© !");
        });

        // üîπ Admin
        function toggleAdminLogin() {
            document.getElementById('admin-login').style.display = adminLoggedIn ? 'none' : 'block';
        }

        document.getElementById('admin-login-form').addEventListener('submit', e => {
            e.preventDefault();
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            if(email === 'admin@sib.tn' && password === 'sadok2025') {
                adminLoggedIn = true;
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
            } else alert("Acc√®s refus√© !");
        });

        function logoutAdmin() {
            adminLoggedIn = false;
            document.getElementById('admin-panel').style.display = 'none';
        }

        // üîπ Ajouter produit Admin
        document.getElementById('add-product-form').addEventListener('submit', e => {
            e.preventDefault();
            const name = document.getElementById('product-name').value;
            const price = document.getElementById('product-price').value;
            const stock = document.getElementById('product-stock').value;
            const photo = document.getElementById('product-photo').value;
            products.push({ id: Date.now(), name, price, stock, photo });
            displayProducts();
            sauvegarderDonnees();
        });

        // üîπ Afficher clients admin
        function displayClients() {
            const div = document.getElementById('clients-list');
            div.innerHTML = clients.map(c => `<p>${c.email} - ${c.type} ${c.matricule || ''}</p>`).join('');
        }

        // üîπ Afficher commandes admin
        function displayOrders() {
            const div = document.getElementById('orders-list');
            div.innerHTML = orders.map(o => `<p>ID: ${o.id}, Status: ${o.status}, Articles: ${o.items.map(i => i.name).join(', ')}</p>`).join('');
        }

        // üîπ Mettre √† jour site admin
        function updateSiteInfo() {
            const logo = document.getElementById('new-logo').value;
            const contact = document.getElementById('new-contact').value;
            const announcement = document.getElementById('new-announcement').value;
            if(logo) siteInfo.logo = logo;
            if(contact) siteInfo.contact = contact;
            if(announcement) siteInfo.announcements.push(announcement);
            updateSiteUI();
            sauvegarderDonnees();
        }

        function updateSiteUI() {
            document.getElementById('site-logo').src = siteInfo.logo;
            const annDiv = document.getElementById('announcements');
            annDiv.innerHTML = siteInfo.announcements.map(a => `<div class="alert-announcement">${a}</div>`).join('');
        }

        // üîπ Initialisation
        chargerDonnees();
    </script>
</body>
</html>
